---
title: "Interactive multi-channel image visualization in R"
date: "`r BiocStyle::doc_date()`"
package: "`r BiocStyle::pkg_ver('cytoviewer')`"
author:
- name: Lasse Meyer
  affiliation: 
  - Department for Quantitative Biomedicine, University of Zurich
  - Institute for Molecular Health Sciences, ETH Zurich
  email: lasse.meyer@dqbm.uzh.ch
- name: Nils Eling
  affiliation: 
  - Department for Quantitative Biomedicine, University of Zurich
  - Institute for Molecular Health Sciences, ETH Zurich
  email: nils.eling@dqbm.uzh.ch
output:
    BiocStyle::html_document:
        toc_float: yes
bibliography: library.bib
abstract: |
    This R package supports interactive visualization of multi-channel images 
    and segmentation masks generated by imaging mass cytometry and other highly 
    multiplexed imaging techniques using shiny. The cytoviewer package is divided
    into image-level (Composite and Channels) and cell-level visualization (Masks). 
    It allows users to overlay individual images with segmentaion masks, 
    integrates well with SingleCellExperiment and SpatialExperiment objects for 
    metadata visualization and supports uncomplicated image downloads.
vignette: |
    %\VignetteIndexEntry{"Interactive multi-channel image visualization in R"}
    %\VignetteEncoding{UTF-8}
    %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  markdown: 
    wrap: 72
---

```{r, echo=FALSE, results="hide"}
knitr::opts_chunk$set(error=FALSE, warning=FALSE, message=FALSE,
                        fig.retina = 0.75, crop = NULL)
library(BiocStyle)
```

```{r library, echo=FALSE}
library(cytoviewer)
```

# Introduction

This vignette introduces the `cytoviewer` package for interactive
multi-channel image visualization. Images as well as corresponding
segmentation masks generated by imaging mass cytometry (IMC) and other
highly multiplexed imaging techniques can be interactively visualized
and explored.

The `cytoviewer` package builds on top of the `r Biocpkg("cytomapper")`
Bioconductor package and extends the static visualization strategies
provided by `cytomapper` via an **interactive Shiny application**. The
`cytoviewer` package leverages the image handling, analysis and
visualization strategies provided by the `r Biocpkg("EBImage")`
Bioconductor package and offers interactive image visualization
strategies in a similar fashion as `r Biocpkg("iSEE")` for single-cell
data. In addition, building up on `r Biocpkg("SingleCellExperiment")`,
`r Biocpkg("SpatialExperiment")` and `cytomapper::CytoImageList`
classes, the `cytoviewer` package integrates into the Bioconductor
framework for single-cell and image analysis.

## Highly multiplexed imaging

Highly multiplexed imaging allows simultaneous spatially and single-cell
resolved detection of dozens of biological molecules (e.g. proteins) in
their native tissue context. As a result, these technologies allow an
in-depth analysis of complex systems and diseases such as the tumor
microenvironment **[add citation]** and type 1 diabetes progression
**[add citation]**.

Imaging-based spatial proteomics methods **[add citation]** can be
broadly divided into fluorescent cyclic approaches such as tissue-based
cyclic immunofluorescence (t-CyCIF) [@Lin2018] and one-step mass-tag
based approaches such as multiplexed ion beam imaging (MIBI)
[@Angelo2014] and IMC [@Giesen2014].

Of note, the instructions below will focus on the visualization and
exploration of **IMC data** as an example. However, data from other
technologies such as t-CyCIF or MIBI, which produce pixel-level
intensities and (optionally) segmentation masks, can be interactively
visualized with `cytoviewer` as long as they have the appropriate input
format (see Section [Data input format](#DataInputFormat)).

### Imaging mass cytometry

IMC, an advancement of CyTOF, combines antibodies tagged with
isotopically pure rare earth metals with laser ablation and
mass-spectrometry-based detection to produce high-dimensional images
[@Giesen2014]. It captures the spatial expression of over 40 proteins in
parallel at a subcellular resolution of 1 Î¼m. Thus, IMC is able to
detect cytoplasmic and nuclear localization of proteins.

## Image handling and analysis

To fully leverage the information contained in IMC and multiplexed
imaging data in general, computational tools are of key importance.

The main analysis steps, irrespective of the biological question,
include 1) Visual inspection of images for quality control, 2) Image
pre-processing and segmentation and 3) Single-cell and spatial analysis
**[add citation]**.

A comprehensive end-to-end workflow for multiplexed image processing and
analysis **[cite]** with detailed information for every analysis step
can be found [here]()

Importantly, the `cytoviewer` package can support, simplify and improve
any of these analysis steps with easy-to-use interactive visualization
in R. Below we will showcase an [example workflow](#ExampleWorkflow)
that highlights the different functionalities and potential application
fields of `cytoviewer`.

## Application overview

The `cytoviewer` package is divided into image-level (Composite and
Channels) and cell-level visualization (Masks). It allows users to
overlay individual images with segmentaion masks, integrates well with
SingleCellExperiment and SpatialExperiment objects for metadata
visualization and supports uncomplicated image downloads.

### Data input format {#DataInputFormat}

### Data input variations {#DataInputVariation}

# Example workflow {#ExampleWorkflow}

## Installation

```{r installation, eval=FALSE}
if (!require("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

BiocManager::install("cytoviewer")
```

The development version of the `cytoviewer` package can be installed
from Github using `remotes` in R as follows:

```{r}
# install.packages("remotes")

remotes::install_github("BodenmillerGroup/cytoviewer", build_vignettes = TRUE, dependencies = TRUE)
```

To load the package in your R session, type the following:

```{r}
library(cytoviewer)
```

## Example dataset

## Interface

## Image-level visualization

## Cell-level visualization

## Image download
